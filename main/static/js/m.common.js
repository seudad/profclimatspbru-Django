"use strict";var nUSER={name:'',email:'',phone:'',basket:[]};var nSESSION={};nSESSION.init=function(){var v_user=$.jStorage.get('nCPROF1');if((v_user!==null)&&(typeof v_user==='object')){nUSER=v_user}else{nUSER={basket:[]};nSESSION.save()}};nSESSION.save=function(){ $.jStorage.set('nCPROF1',nUSER,{TTL:3*3600*1000})};var nBASKET={};nBASKET.clear=function(){nUSER.basket=[];nSESSION.save(); $('#basket').hide()};nBASKET.buy=function(){var v_data=$(this).data();console.log('unit-info-buy',nUSER.basket,v_data);var v_no;for(var v_i=0;v_i<nUSER.basket.length;v_i++){if(nUSER.basket[v_i].key===v_data.key){v_no=v_i}}if(v_no===undefined){v_data.count=1;nUSER.basket.push(v_data)}else{nUSER.basket[v_no].count++;if(v_data.rub!==nUSER.basket[v_no].rub){nUSER.basket[v_no].rub=v_data.rub}}nSESSION.save();nBASKET.show();nBASKET.ask('Добавлен '+v_data.title)};nBASKET.show=function(){var v_count=0;for(var v_i=0;v_i<nUSER.basket.length;v_i++){v_count+=nUSER.basket[v_i].count}if(v_count>0){ $('#basket').text('['+v_count+']'); $('#basket').show()}else{ $('#basket').hide()}};nBASKET.ask=function(p_text){var v_ask=$('<div/>',{Class:'basket-lock'});var v_msg=$('<div/>',{Class:'basket-ask'});var v_close=$('<div/>',{Class:'basket-close'});var v_text=$('<div/>',{Class:'basket-text',html:p_text});var v_next=$('<div/>',{Class:'basket-next'});var v_submit=$('<div/>',{Class:'basket-submit'});v_msg.append(v_close).append(v_text).append(v_next).append(v_submit);v_ask.append(v_msg);v_close.click(function(){v_ask.hide();v_ask.remove()});v_next.click(function(){v_ask.hide();v_ask.remove()});v_submit.click(function(){v_ask.hide();v_ask.remove();window.location='/basket'}); $('body').append(v_ask);v_ask.show()};