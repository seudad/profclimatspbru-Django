function nREG(p_pfx){if(p_pfx===undefined){p_pfx='reg'}this.pfx=p_pfx;this.usr={};this.win=$('#'+p_pfx+'-win');this.win_title=$('#'+p_pfx+'-win-title');this.win_body=$('#'+p_pfx+'-win-body');this.win_uid=$('#'+p_pfx+'-uid');this.win_pass1=$('#'+p_pfx+'-pass1');this.win_pass2=$('#'+p_pfx+'-pass2');this.win_name=$('#'+p_pfx+'-name');this.win_patronymic=$('#'+p_pfx+'-patronymic');this.win_surname=$('#'+p_pfx+'-surname');this.win_email=$('#'+p_pfx+'-email');this.win_address=$('#'+p_pfx+'-address');this.win_phone=$('#'+p_pfx+'-phone');this.win_ctrl=$('#'+p_pfx+'-win-ctrl');this.win_reg=$('#_reg-reg');this.win_close=$('#_reg-close');var v_this=this;this.reg=function(){};this.close=function(){};this.win_reg.click(function(){var v_errors=0;for(var v_i=0;v_i<v_list.length;v_i++){v_list[v_i][0].removeClass('error-param')}var v_param={uid:v_this.win_uid.val().trim(),name:v_this.win_name.val(),patronymic:v_this.win_patronymic.val(),surname:v_this.win_surname.val(),email:v_this.win_email.val(),address:v_this.win_address.val(),phone:v_this.win_phone.val()};if(!/^[-_a-z0-9]{1,20}$/i.test(v_param.uid)){v_this.win_uid.addClass('error-param');v_errors++}var v_pass1=v_this.win_pass1.val();var v_pass2=v_this.win_pass2.val();if(!/^[-_.~а-яА-ЯёЁa-zA-Z0-9]{5,}$/i.test(v_pass1)){v_this.win_pass1.addClass('error-param');v_this.win_pass2.addClass('error-param');v_errors++}else if(v_pass1!==v_pass2){v_this.win_pass1.addClass('error-param');v_this.win_pass2.addClass('error-param');v_errors++}if(!/^[-а-яё]{1,}$/i.test(v_param.name)){v_this.win_name.addClass('error-param');v_errors++}if(!/^[-а-яё]*$/i.test(v_param.surname)){v_this.win_surname.addClass('error-param');v_errors++}if(!/^[-а-яё]*$/i.test(v_param.patronymic)){v_this.win_patronymic.addClass('error-param');v_errors++}if(!/^[-\w.]+@([A-z0-9][-A-z0-9]+\.)+[A-z]{2,4}$/i.test(v_param.email)){v_this.win_email.addClass('error-param');v_errors++}if(!/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/i.test(v_param.phone)){v_this.win_phone.addClass('error-param');v_errors++}if(v_errors>0){return}v_param.hash=CryptoJS.MD5(v_pass1+'~'+v_param.uid).toString(); $.ajax({type:"POST",url:nCFG.ajax.get_path('nUSR.add.pl'),data:v_param,dataType:"json",error:v_this.ajax_error,success:function(p_res){if(parseInt(p_res.rc,10)!==0){v_this.req_error(p_res);return}v_this.usr=p_res.usr;v_this.win.hide();if(typeof v_this.reg==='function'){v_this.reg()}}})});this.win_close.click(function(){v_this.win.hide();v_this.close()}); $('body').append(this.win)}nREG.prototype.req_error=function(p_res){};nREG.prototype.ajax_error=function(xmlhttp,textStatus,errorThrown){if(xmlhttp.status===404){}else{}};nREG.prototype.show=function(){this.win.css({top:0,right:0});this.win.show()};nREG.prototype.hide=function(){this.win.hide()};nREG.prototype.set_reg=function(p_function){this.reg=p_function};nREG.prototype.set_close=function(p_function){this.close=p_function};