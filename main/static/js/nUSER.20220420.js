"use strict";var nUSER={data:{}};var nSESSION={};nSESSION.rest=function(){var v_data=$.jStorage.get('nCPROF1');if((v_data!==null)&&(typeof v_data==='object')){nUSER.data=v_data;return true}return false};nSESSION.init=function(){if(!nSESSION.rest()){nUSER.data={name:'',email:'',phone:'',basket:[]};nSESSION.save()}};nSESSION.save=function(){ $.jStorage.set('nCPROF1',nUSER.data,{TTL:3*3600*1000})};var nBASKET={};nBASKET.init=function(){ $('#header-s1-buy').click(nBASKET.submit);nBASKET.show()};nBASKET.submit=function(){window.location.assign('/basket')};nBASKET.clear=function(){nUSER.data.basket=[];nSESSION.save(); $('#basket').hide()};nBASKET.to_basket=function(p_this){let v_data=$(p_this).data();let v_no;nSESSION.rest();for(let v_i=0;v_i<nUSER.data.basket.length;v_i++){if(nUSER.data.basket[v_i].key===v_data.key){v_no=v_i}}if(v_no===undefined){v_data.count=1;nUSER.data.basket.push(v_data)}else{nUSER.data.basket[v_no].count++;if(v_data.rub!==nUSER.data.basket[v_no].rub){nUSER.data.basket[v_no].rub=v_data.rub}}nSESSION.save();return v_data};nBASKET.buy=function(){let v_data=nBASKET.to_basket(this);nBASKET.show();nBASKET.ask('Добавлен '+v_data.title)};nBASKET.buy1clk=function(){let v_data=nBASKET.to_basket(this);nBASKET.show();nBASKET.submit()};nBASKET.show=function(){nBASKET.footer=$('#bottom');nBASKET.basket=$('#basket');let v_count=0;let v_sum=0;for(let v_i=0;v_i<nUSER.data.basket.length;v_i++){v_count+=nUSER.data.basket[v_i].count;v_sum+=Number(nUSER.data.basket[v_i].rub)*nUSER.data.basket[v_i].count}if(v_count>0){v_sum=v_sum.toFixed(0).replace(/(\d{1,3}(?=(\d{3})+(?:\.\d|\b)))/g,"\$1 "); $('#basket-info').text(v_count+' на '+v_sum+' руб.')}else{ $('#basket-info').text('Пусто')}nBASKET.basket=$('#header-s1-buy'); $('#header-s1-buy-count').text(v_count);if(v_count>0){ $('#header-s1-buy').attr('title',v_count+' на '+v_sum+' руб.')}};nBASKET.ask=function(p_text){nBASKET._lock=$('<div/>',{Class:'win-lock'});nBASKET._msg=$('<div/>',{Class:'basket-ask'});nBASKET._close=$('<div/>',{Class:'basket-ask-close'});nBASKET._text=$('<div/>',{Class:'basket-ask-text',html:p_text});nBASKET._next=$('<div/>',{Class:'basket-ask-next'});nBASKET._submit=$('<div/>',{Class:'basket-ask-submit'});nBASKET._msg.append(nBASKET._close).append(nBASKET._text).append(nBASKET._next).append(nBASKET._submit);nBASKET._close.click(function(){nBASKET._msg.hide();nBASKET._msg.remove();nBASKET._lock.hide();nBASKET._lock.remove(); $(document).off('keyup',nBASKET.esc)});nBASKET._next.click(function(){nBASKET._close.click()});nBASKET._submit.click(function(){nBASKET._close.click();nBASKET.submit()}); $('body').append(nBASKET._lock).append(nBASKET._msg); $(document).on('keyup',nBASKET.esc);nBASKET._lock.show();nBASKET._msg.show()};nBASKET.esc=function(p_event){if(p_event.keyCode===27){nBASKET._close.click()}};nBASKET.resize=function(){};nUSER.init=function(){ $('#button-up').click(function(){ $(window).scrollTop(0)}); $('#button-down').click(function(){ $(window).scrollTop($(document).height())});nSESSION.init();nBASKET.init(); $('#view-mode').click(function(){console.log('view-mode.010:', $(this).data('mode'));document.cookie="mode="+ $(this).data('mode')+"; path=/; SameSite=Strict";console.log('view-mode.030:',document.cookie)});if(screen.width<720||screen.height<720){if($('#view-mode').data('mode')==='mobile'){ $('#view-mode').click()}else{}}else{ $('#view-mode').show()}if($('#header-back').length===1){if(location.pathname==='/'){ $('#header-back').hide()} $('#header-back').click(function(){var v_path=location.pathname.replace(/^(.*?)(\/)?$/,'$1').split('/');v_path.pop();v_path=v_path.join('/');if(v_path===''){v_path='/'}if(v_path!==location.pathname){window.location.assign(v_path)}})}const client_type=$('#client-type').val();const header_location=$('#header-location');const header_location_select=$('#header-location-select');const header_location_click=function(){if(client_type==='mobile'){header_location_select.css({top:'0px',left:'0px',width:'100%'})}else{const pos=header_location.position();header_location_select.css({top:pos.top+'px',left:pos.left+'px'})}header_location_select.show()};header_location.click(header_location_click);header_location_select.on('click','.header-location-select',function(){const data=$(this).data();header_location_select.hide();window.location=data.href});window.addEventListener("orientationchange",function(){console.log('orientationchange.010');if(header_location_select.is(':visible')){header_location_click()}},false); $(window).resize(function(){if(header_location_select.is(':visible')){const pos=header_location.position();header_location_select.css({top:pos.top+'px',left:pos.left+'px'})}nBASKET.resize()})};