"use strict";var nUSER={data:{}};var nSESSION={};nSESSION.rest=function(){var v_data=$.jStorage.get('nCPROF1');if((v_data!==null)&&(typeof v_data==='object')){nUSER.data=v_data;return true}return false};nSESSION.init=function(){if(!nSESSION.rest()){nUSER.data={name:'',email:'',phone:'',basket:[]};nSESSION.save()}};nSESSION.save=function(){ $.jStorage.set('nCPROF1',nUSER.data,{TTL:3*3600*1000})};var nBASKET={};nBASKET.clear=function(){nUSER.data.basket=[];nSESSION.save(); $('#basket').hide()};nBASKET.buy=function(){var v_data=$(this).data();var v_no;nSESSION.rest();for(var v_i=0;v_i<nUSER.data.basket.length;v_i++){if(nUSER.data.basket[v_i].key===v_data.key){v_no=v_i}}if(v_no===undefined){v_data.count=1;nUSER.data.basket.push(v_data)}else{nUSER.data.basket[v_no].count++;if(v_data.rub!==nUSER.data.basket[v_no].rub){nUSER.data.basket[v_no].rub=v_data.rub}}nSESSION.save();nBASKET.show();nBASKET.ask('Добавлен '+v_data.title)};nBASKET.show=function(){nBASKET.footer=$('#bottom');nBASKET.basket=$('#basket');var v_count=0;var v_sum=0;for(var v_i=0;v_i<nUSER.data.basket.length;v_i++){v_count+=nUSER.data.basket[v_i].count;v_sum+=Number(nUSER.data.basket[v_i].rub)*nUSER.data.basket[v_i].count}if(v_count>0){v_sum=v_sum.toFixed(0).replace(/(\d{1,3}(?=(\d{3})+(?:\.\d|\b)))/g,"\$1 "); $('#basket-info').text(v_count+' на '+v_sum+' руб.');nBASKET.basket.show();nBASKET.resize()}else{ $('#basket-info').text('Пусто');nBASKET.basket.hide()}};nBASKET.ask=function(p_text){nBASKET._lock=$('<div/>',{Class:'win-lock'});nBASKET._msg=$('<div/>',{Class:'basket-ask'});nBASKET._close=$('<div/>',{Class:'basket-ask-close'});nBASKET._text=$('<div/>',{Class:'basket-ask-text',html:p_text});nBASKET._next=$('<div/>',{Class:'basket-ask-next'});nBASKET._submit=$('<div/>',{Class:'basket-ask-submit'});nBASKET._msg.append(nBASKET._close).append(nBASKET._text).append(nBASKET._next).append(nBASKET._submit);nBASKET._close.click(function(){nBASKET._msg.hide();nBASKET._msg.remove();nBASKET._lock.hide();nBASKET._lock.remove(); $(document).off('keyup',nBASKET.esc)});nBASKET._next.click(function(){nBASKET._close.click()});nBASKET._submit.click(function(){nBASKET._close.click();window.location='/basket'}); $('body').append(nBASKET._lock).append(nBASKET._msg); $(document).on('keyup',nBASKET.esc);nBASKET._lock.show();nBASKET._msg.show()};nBASKET.esc=function(p_event){if(p_event.keyCode===27){nBASKET._close.click()}};nBASKET.resize=function(){var v_pos=nBASKET.footer.position();nBASKET.basket.css({'width':nBASKET.footer.outerWidth()+'px','left':v_pos.left+'px'});nBASKET.footer.css('margin-bottom',nBASKET.basket.outerHeight()+'px')};nUSER.init=function(){ $('#button-up').click(function(){ $(window).scrollTop(0)}); $('#button-down').click(function(){ $(window).scrollTop($(document).height())});nSESSION.init();nBASKET.show(); $('#view-mode').click(function(){console.log('view-mode.010:', $(this).data('mode'));document.cookie="mode="+ $(this).data('mode')+"; path=/; SameSite=Strict";console.log('view-mode.030:',document.cookie)});if(screen.width<720||screen.height<720){if($('#view-mode').data('mode')==='mobile'){ $('#view-mode').click()}else{}}else{ $('#view-mode').show()}if($('#header-back').length===1){if(location.pathname==='/'){ $('#header-back').hide()} $('#header-back').click(function(){var v_path=location.pathname.replace(/^(.*?)(\/)?$/,'$1').split('/');v_path.pop();v_path=v_path.join('/');if(v_path===''){v_path='/'}if(v_path!==location.pathname){window.location.assign(v_path)}})} $(window).resize(nBASKET.resize)};