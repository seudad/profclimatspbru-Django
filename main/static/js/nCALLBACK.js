"use strict";var nCALLBACK={}; $(document).ready(function(){ $('#callback-time-from').timepicker({timeFormat:'H:mm',interval:15,minTime:'08:00',maxTime:'22:30',defaultTime:'10:00',startTime:'10:00',dynamic:false,dropdown:true,scrollbar:true}); $('#callback-time-to').timepicker({timeFormat:'H:mm',interval:15,minTime:'08:00',maxTime:'22:30',defaultTime:'20:00',startTime:'20:00',dynamic:false,dropdown:true,scrollbar:true}); $('#callback-clear').click(nCALLBACK.clear); $('#callback-submit').click(nCALLBACK.send)});nCALLBACK.clear=function(){ $('#callback-name').val(''); $('#callback-phone').val(''); $('#callback-email').val(''); $('#callback-time-from').val('10:00'); $('#callback-time-to').val('20:00'); $('#callback-text').val('')};nCALLBACK.send=function(){var v_msg={cmd:'send',name: $('#callback-name').val().trim(),phone: $('#callback-phone').val().trim(),email: $('#callback-email').val().trim(),from: $('#callback-time-from').val().trim(),to: $('#callback-time-to').val().trim(),text: $('#callback-text').val().trim()};var v_errors=0; $('#callback-name').removeClass('error'); $('#callback-phone').removeClass('error'); $('#callback-email').removeClass('error');if(!/^[-А-ЯA-Z. ]+$/i.test(v_msg.name)){ $('#callback-name').addClass('error');return}if((v_msg.email==='')&&(v_msg.phone==='')){ $('#callback-phone').addClass('error'); $('#callback-email').addClass('error');return}if(v_msg.email){if(/^[\w]{1}[\w-\.]*@[\w-]+\.[a-z]{2,4}$/i.test(v_msg.email)){}else{ $('#callback-email').addClass('error');v_errors++}}if(v_msg.phone){if(/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/.test(v_msg.phone)){}else{ $('#callback-phone').addClass('error');v_errors++}}if(!/^(\d{1,2}):(\d{1,2})$/.test(v_msg.from)){ $('#callback-time-from').addClass('error');v_errors++}if(!/^(\d{1,2}):(\d{1,2})$/.test(v_msg.to)){ $('#callback-time-to').addClass('error');v_errors++}if(v_errors){return}nAJAX.running_on(); $.ajax({type:"POST",url:'/cgi-bin/x-callback.pl',data:v_msg,dataType:"json",error:function(xmlhttp,textStatus,errorThrown){console.log('ajax_error:',xmlhttp,textStatus,errorThrown);if(xmlhttp.status===404){ $('#callback-err-msgs').text('Извините, данная ссылка в настоящее время не работает')}else{ $('#callback-err-msgs').text('Ошибка AJAX: ['+xmlhttp.status+']: '+xmlhttp.statusText)} $('#callback-form').hide(); $('#callback-err').show();nAJAX.running_off()},success:function(p_res){ $('#callback-form').hide();if(parseInt(p_res.rc,10)!==0){ $('#callback-fail').show()}else{ $('#callback-succ').show()}nAJAX.running_off()}})};