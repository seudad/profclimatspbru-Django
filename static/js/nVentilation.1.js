"use strict";var nVUNITS={_dummy_:null};nVUNITS.price_min=function(){return Number($('#price-min').val().trim())};nVUNITS.price_max=function(){return Number($('#price-max').val().trim())};nVUNITS.filter_price_init=function(){let v_step=Number($("#vunits-filter-price-min").attr('step')); $("#vunits-filter-price-min").attr('min',nVUNITS.price_min()); $("#vunits-filter-price-min").attr('max',nVUNITS.price_max()); $("#vunits-filter-price-min").val(nVUNITS.price_min); $("#vunits-filter-price-max").attr('min',nVUNITS.price_min()); $("#vunits-filter-price-max").attr('max',nVUNITS.price_max()); $("#vunits-filter-price-max").val(nVUNITS.price_min());let v_units_filter_price_min=parseInt($("#vunits-filter-price-min").attr('min').trim(),10);let v_units_filter_price_max=parseInt($("#vunits-filter-price-max").attr('max').trim(),10); $("#vunits-filter-price-slider").slider({animate:true,values:[v_units_filter_price_min,v_units_filter_price_max],range:true,min:v_units_filter_price_min,max:v_units_filter_price_max,step:v_step,slide:function(event,ui){ $("#vunits-filter-price-min").val(ui.values[0]); $("#vunits-filter-price-max").val(ui.values[1])},change:function(event,ui){ $("#vunits-filter-price-min").val(ui.values[0]); $("#vunits-filter-price-max").val(ui.values[1])}}); $('#vunits-filter-price-min').change(function(e){ $('#vunits-filter-price-slider').slider("values",0, $(this).val())}); $('#vunits-filter-price-max').change(function(e){ $('#vunits-filter-price-slider').slider("values",1, $(this).val())}); $('#vunits-filter-price-min').change(); $('#vunits-filter-price-max').change()};nVUNITS.filter_range_param_init=function(p_no){let v_filter_param_min=$('#vunits-filter-p'+p_no+'-min');let v_filter_param_max=$('#vunits-filter-p'+p_no+'-max');let v_filter_param_slider=$('#vunits-filter-p'+p_no+'-slider');let v_step=Number(v_filter_param_min.attr('step'));let v_min=parseInt(v_filter_param_min.attr('min').trim(),10);let v_max=parseInt(v_filter_param_max.attr('max').trim(),10);v_filter_param_slider.slider({animate:true,values:[v_min,v_max],range:true,min:v_min,max:v_max,step:v_step,slide:function(event,ui){v_filter_param_min.val(ui.values[0]);v_filter_param_max.val(ui.values[1])},change:function(event,ui){v_filter_param_min.val(ui.values[0]);v_filter_param_max.val(ui.values[1])}});v_filter_param_min.change(function(p_event){v_filter_param_slider.slider("values",0, $(this).val())});v_filter_param_max.change(function(p_event){v_filter_param_slider.slider("values",1, $(this).val())});v_filter_param_min.change();v_filter_param_max.change()};nVUNITS.filter_checks_param_init=function(p_no){ $('input[name=vunits-filter-p'+p_no+']').prop('checked',false)};nVUNITS.filter_bool_param_init=function(p_no){ $('input[name=vunits-filter-p'+p_no+'][value=""]').prop('checked',true)};nVUNITS.filter_reset=function(){nVUNITS.filter_price_init(); $('#vunits-filter-manufacturer input[type=checkbox]').each(function(){ $(this).prop('checked',false)});let v_codes=$('#filters-codes').val().trim().split(',');for(let v_i=0;v_i<v_codes.length;v_i++){switch($('#vunits-filter-p'+v_codes[v_i]).data('type')){case'range':nVUNITS.filter_range_param_init(v_codes[v_i]);break;case'checks':nVUNITS.filter_checks_param_init(v_codes[v_i]);break;case'bool':nVUNITS.filter_bool_param_init(v_codes[v_i]);break;default:console.log('nVUNITS.filter_reset: ERROR: ', $('#vunits-filter-p'+v_codes[v_i]).data())}}};nVUNITS.filter_use=function(){nVUNITS.get(nVUNITS.build_param())};nVUNITS.build_param=function(){let v_filter={};let v_param_val,v_param_min,v_param_max;v_filter.price_min=Number($("#vunits-filter-price-min").val().trim());v_filter.price_max=Number($("#vunits-filter-price-max").val().trim());let v_manufactures=[]; $('#vunits-filter-manufacturer input[name=filter-manufacturer]:checked').each(function(){v_manufactures.push(this.value)});if(v_manufactures.length){v_filter.m=v_manufactures.join(',')}let v_codes=$('#filters-codes').val().split(',');for(let v_i=0;v_i<v_codes.length;v_i++){let v_filter_param=$('#vunits-filter-p'+v_codes[v_i]);if(v_filter_param.length){switch(v_filter_param.data('type')){case'checks':v_param_val=[]; $('input[name=vunits-filter-p'+v_codes[v_i]+']:checked').each(function(){v_param_val.push($(this).val())});if(v_param_val.length){v_filter['p'+v_codes[v_i]]=v_param_val.join(',')}break;case'range':v_param_min=$('#vunits-filter-p'+v_codes[v_i]+'-min').val().trim();v_param_max=$('#vunits-filter-p'+v_codes[v_i]+'-max').val().trim();v_filter['p'+v_codes[v_i]]=[v_param_min,v_param_max].join(',');break;case'bool':v_param_val=$('input[name=vunits-filter-p'+v_codes[v_i]+']:checked').val();if(v_param_val!==''){v_filter['p'+v_codes[v_i]]=v_param_val}break;default:}}}return v_filter};nVUNITS.get=function(p_filter){p_filter.q=1; $('#_running').show(); $.ajax({url:window.location.origin+window.location.pathname,data:p_filter,type:"POST",async:true,dataType:'html',error:function(p_XHR,p_textStatus,p_errorThrown){ $('#_running').hide()},success:function(p_data){ $('#vunits-list').html(p_data); $('#_running').hide()}})};nVUNITS.get_more=function(){let v_params=nVUNITS.build_param();v_params.p=Number($('#pg-no').val())+1;let v_pg_count=Number($('#pg-count').val());v_params.psz=Number($('#units-toolbar-psize').data('value'));if(v_params.p>v_pg_count){return}if(v_params.psz===999999){return} $('#_running').show();if(v_params.p===v_pg_count){ $('#pg-more-get').hide()}let v_url=window.location.origin+window.location.pathname+ $.buildParams(v_params);window.history.pushState(null,null,v_url); $.ajax({url:v_url+'&q=2',async:true,dataType:'json',error:function(p_XHR,p_textStatus,p_errorThrown){ $('#_running').hide()},success:function(p_data){ $('#vunits-list-items').append(p_data.html); $('#pages-index').html(p_data.pg.refs); $('#_running').hide()}})};nVUNITS.toolbar_filter_switch=function(){if($('#vunits-filter').is(':visible')){ $('#units-filter-hide').css('display','inline-block'); $('#units-filter-show').css('display','none')}else{ $('#units-filter-hide').css('display','none'); $('#units-filter-show').css('display','inline-block')} $('#units-filter-hide').click(function(){ $('#vunits-filter').hide(); $('#units-filter-hide').css('display','none'); $('#units-filter-show').css('display','inline-block')}); $('#units-filter-show').click(function(){console.log('nVUNITS.toolbar_filter_switch.show'); $('#vunits-filter').show(); $('#units-filter-hide').css('display','inline-block'); $('#units-filter-show').css('display','none')})}; $(document).ready(function(){nPOPUPMENU.init('#units-toolbar-sort');nPOPUPMENU.init('#units-toolbar-psize'); $('#vunits-filter-manufacturer-pop').click(function(){}); $('#vunits-filter-manufacturer-all').click(function(){}); $("#vunits-list").on('click','.units-item-buy',nBASKET.buy); $('#vunits-filter-manufacturer').on('change','input[type=checkbox]',function(){nVUNITS.filter_use();return}); $('#units-toolbar-image').click(function(p_event){p_event.preventDefault()});nVUNITS.toolbar_filter_switch();nVUNITS.filter_reset();nPOPUPMENU.set('#units-toolbar-sort', $('#pg-sort').val());nPOPUPMENU.set('#units-toolbar-psize',Number($('#pg-size').val()));nPOPUPMENU.change('#units-toolbar-sort',function(){let v_args=$.getUrlVars();v_args.sort=$('#units-toolbar-sort').data('value');let v_params=$.buildParams(v_args);let v_url=window.location.origin+window.location.pathname;window.location.href=v_url+v_params});nPOPUPMENU.change('#units-toolbar-psize',function(){let v_args=$.getUrlVars();v_args.psz=$('#units-toolbar-psize').data('value');let v_params=$.buildParams(v_args);let v_url=window.location.origin+window.location.pathname;window.location.href=v_url+v_params}); $('#vunits-filter-use').click(nVUNITS.filter_use); $('#vunits-filter-clear').click(function(){nVUNITS.filter_reset();nVUNITS.get({price_min:nVUNITS.price_min(),price_max:nVUNITS.price_max()})});nUSER.init();nSHAVE.init();nHEADER.init();nFIND.init();let v_params=$.getUrlVars();let v_vars=$.getUrlVars();v_vars.f='tile'; $('#units-toolbar-show-tile').attr('href','?'+ $.buildParams(v_vars));v_vars.f='table'; $('#units-toolbar-show-table').attr('href','?'+ $.buildParams(v_vars));v_vars=$.getUrlVars(); $('#units-toolbar-refresh').attr('href', $.buildParams(v_vars)); $('#units-toolbar-refresh').click(function(){nVUNITS.filter_use();return});if(Number($('#req-pgno').val())>=Number($('#pg_count').val())){ $('#pg-more-get').hide()}else{ $('#pg-more-get').click(nVUNITS.get_more)}if(v_params.m){let v_m=v_params.m.split(',');let v_manufacturers={};for(let v_i=0;v_i<v_m.length;v_i++){v_manufacturers[unescape(v_m[v_i])]=true} $('input[name=filter-manufacturer]').each(function(){ $(this).prop('checked',(v_manufacturers[this.value]?true:false))})}});