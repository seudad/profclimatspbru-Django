"use strict";nHUNITS.get_manufacturer_filter=function(){var v_manufacturers=[]; $("#hunits-filter-manufacturer div").each(function(p_index){if(nCOMMON.check_is_on(this)){v_manufacturers.push(nCOMMON.check_value(this))}});return v_manufacturers};nHUNITS.is_utype_ok=function(p_utype){var v_ok=false; $("#hunits-filter-utype div").each(function(p_index){if(nCOMMON.check_is_on(this)){if(nCOMMON.check_value(this)===p_utype){v_ok=true}}});return v_ok};nHUNITS.get_utypes_filter=function(p_manufacturer){var v_utypes=[];for(var v_utype in nHUNITS.list[p_manufacturer]){if(nHUNITS.is_utype_ok(v_utype)){v_utypes.push(v_utype)}}return v_utypes};nHUNITS.get_models_filter=function(p_manufacturer,p_utype){var v_models=[];for(var v_model in nHUNITS.list[p_manufacturer][p_utype]){v_models.push(v_model)}return v_models};nHUNITS.show_units_tile=function(){nUNITS.toolbar_show_tile();var v_units=$("#hunits-list").empty();var v_price_min=parseInt($('#hunits-filter-price-min').val(),10);var v_price_max=parseInt($('#hunits-filter-price-max').val(),10);var v_service_area_min=$('#hunits-filter-service_area-min').val()*1;var v_service_area_max=$('#hunits-filter-service_area-max').val()*1;var v_noise_level_min1=$('#hunits-filter-noise_level-min1').val()*1;var v_noise_level_min2=$('#hunits-filter-noise_level-min2').val()*1;var v_noise_level_max1=$('#hunits-filter-noise_level-max1').val()*1;var v_noise_level_max2=$('#hunits-filter-noise_level-max2').val()*1;var v_power_heating_min=$('#hunits-filter-power_heating-min').val()*1;var v_power_heating_max=$('#hunits-filter-power_heating-max').val()*1;nHUNITS.get_units(function(p_manufacturer,p_utype,p_model){var v_unit=nHUNITS.get_unit(p_manufacturer,p_utype,p_model);if(v_unit.state===0){return}var v_price=nUNITS.get_price(v_unit);if((v_price<v_price_min)||(v_price>v_price_max)){return}if((nHUNITS.power_max(v_unit.power.heat)<v_power_heating_min)||(nHUNITS.power_max(v_unit.power.heat)>v_power_heating_max)){return}if(nHUNITS.find.text){var v_res1=nHUNITS.find.test(p_manufacturer+' '+p_utype+' '+p_model);var v_res2=nHUNITS.find.test(v_unit.desc);if(!(v_res1||v_res2)){return}}var v_item=nUNITS.units_item(p_manufacturer+' '+p_utype+' '+p_model,v_unit.state,v_price,v_unit.thumbnail,{unit:v_unit,manufacturer:p_manufacturer,utype:p_utype,model:p_model},encodeURI('#p/unit-info/T1?u='+p_manufacturer+'::'+p_utype+'::'+p_model));v_units.append(v_item)})};nHUNITS.show_units_table=function(){nUNITS.toolbar_show_table();var v_units=$("#hunits-list").empty();var v_table=$('<table/>',{Class:"listtable",width:'100%'});var v_thead=$('<thead/>');var v_tbody=$('<tbody/>');var v_tr='<tr><th></th><th class="sortable">Производитель</th><th class="sortable">Класс</th><th class="sortable">Модель</th><th>Вид</th><th class="sortable">Размеры</th><th class="sortable">Тепловая мощность,<br>кВт</th><th class="sortable">Цена (руб.)</th></tr>';v_thead.append(v_tr);v_table.append(v_thead);v_table.append(v_tbody);var v_price_min=parseInt($('#hunits-filter-price-min').val(),10);var v_price_max=parseInt($('#hunits-filter-price-max').val(),10);var v_service_area_min=$('#hunits-filter-service_area-min').val();var v_service_area_max=$('#hunits-filter-service_area-max').val();var v_noise_level_min1=$('#hunits-filter-noise_level-min1').val();var v_noise_level_min2=$('#hunits-filter-noise_level-min2').val();var v_noise_level_max1=$('#hunits-filter-noise_level-max1').val();var v_noise_level_max2=$('#hunits-filter-noise_level-max2').val();var v_power_heating_min=$('#hunits-filter-power_heating-min').val();var v_power_heating_max=$('#hunits-filter-power_heating-max').val();nHUNITS.get_units(function(p_manufacturer,p_utype,p_model){var v_unit=nHUNITS.get_unit(p_manufacturer,p_utype,p_model);if(v_unit.state===0){return}var v_price=nUNITS.get_price(v_unit);if((v_price<v_price_min)||(v_price>v_price_max)){return}if((nHUNITS.power_max(v_unit.power.heat)<v_power_heating_min)||(nHUNITS.power_max(v_unit.power.heat)>v_power_heating_max)){return}if(nHUNITS.find.text){var v_res1=nHUNITS.find.test(p_manufacturer+' '+p_utype+' '+p_model);var v_res2=nnHUNITS.find.test(v_unit.desc);if(!(v_res1||v_res2)){return}}var v_tr;var v_href=encodeURI('#p/unit-info/T1?u='+p_manufacturer+'::'+p_utype+'::'+p_model);if(v_unit.state===1){v_tr=$('<tr><td align="center"><div class="unit-item-buy typcn typcn-shopping-cart" title="Купить"></div></td><td class="unit-item-select">'+p_manufacturer+'</td><td class="unit-item-select">'+p_utype+'</td><td class="unit-item-select"><a href="'+v_href+'">'+p_model+'</a></td><td align="center">'+nUNITS.img_thumbnail_html(v_unit.thumbnail)+'</td><td class="ctxt">'+nHUNITS.show_sizes(v_unit.sizes.int)+'</td><td class="num">'+nCOMMON.put_value(v_unit.power.heat)+'</td><td class="num">'+v_price.digits()+'</td></tr>')}else if(v_unit.state===2){v_tr=$('<tr><td align="center"><div class="unit-item-buy typcn typcn-shopping-cart" title="Купить"></div></td><td class="unit-item-select unit-item-on_request">'+p_manufacturer+'</td><td class="unit-item-select unit-item-on_request">'+p_utype+'</td><td class="unit-item-select unit-item-on_request"><a href="'+v_href+'">'+p_model+'</a></td><td align="center">'+nUNITS.img_thumbnail_html(v_unit.thumbnail)+'</td><td class="ctxt unit-item-on_request">'+nHUNITS.show_sizes(v_unit.sizes.int)+'</td><td class="num  unit-item-on_request">'+nCOMMON.put_value(v_unit.power.heat)+'</td><td class="num  unit-item-on_request">'+v_price.digits()+'</td></tr>')}else{v_tr=$('<tr><td align="center"><div class="unit-item-buy typcn typcn-shopping-cart" title="Купить"></div></td><td class="unit-item-select">'+p_manufacturer+'</td><td class="unit-item-select">'+p_utype+'</td><td class="unit-item-select"><a href="'+v_href+'">'+p_model+'</a></td><td align="center">'+nUNITS.img_thumbnail_html(v_unit.thumbnail)+'</td><td class="ctxt">'+nHUNITS.show_sizes(v_unit.sizes.int)+'</td><td class="num">'+nCOMMON.put_value(v_unit.power.heat)+'</td><td class="num">'+v_price.digits()+'</td></tr>')}v_tr.data({unit:v_unit,manufacturer:p_manufacturer,utype:p_utype,model:p_model});v_tbody.append(v_tr)});v_units.append(v_table)};nHUNITS.show_units=function(){if(nHUNITS.units_show_format==='tile'){nHUNITS.show_units_tile()}else if(nHUNITS.units_show_format==='table'){nHUNITS.show_units_table()}else{}};nHUNITS.options_show_filter=function(){var v_dest=$("#hunits-filter-opts").empty();var v_options=nTERMS.get_list('hunits','options');for(var v_i=0;v_i<v_options.length;v_i++){var v_opt=nCOMMON.check_new({style:"width:25em;display:inline-block;",val:v_options[v_i],checked:true});v_dest.append(v_opt);v_dest.append('<span class="check-info" data-group="options" data-item="'+v_options[v_i]+'"><span class="icon-help-circled-alt"></span></span>')}};nHUNITS.utypes_show_filter=function(){var v_dest=$("#hunits-filter-utype").empty();var v_utypes=nTERMS.get_list('hunits','utypes');for(var v_i=0;v_i<v_utypes.length;v_i++){var v_opt=nCOMMON.check_new({style:"width:25em;display:inline-block;",val:v_utypes[v_i],checked:true});v_dest.append(v_opt);v_dest.append('<span class="check-info" data-group="utypes" data-item="'+v_utypes[v_i]+'"><span class="icon-help-circled-alt"></span></span>')}};nHUNITS.units_filter_manufacturer_reset=function(){var v_units_manufacturer=$('#hunits-filter-manufacturer .check');for(var v_i=0;v_i<v_units_manufacturer.length;v_i++){nCOMMON.check_on(v_units_manufacturer[v_i])}};nHUNITS.find.set=function(){nHUNITS.find.text=$('#find-text').val().trim();var v_words=nHUNITS.find.text.replace(/([|().+?*\/\[\]])/g,'\\$1').split(/\s+/);var v_req='';nHUNITS.find.req=[];for(var v_i=0;v_i<v_words.length;v_i++){nHUNITS.find.req.push(new RegExp('\\s*'+v_words[v_i],'i'))}nHUNITS.show_units()};nHUNITS.find.test=function(p_str){for(var v_i=0;v_i<nHUNITS.find.req.length;v_i++){if(!nHUNITS.find.req[v_i].test(p_str)){return false}}return true};nHUNITS.find.clear=function(){ $('#find-text').val('');nHUNITS.find.req=[];nHUNITS.req=[];nHUNITS.show_units()};nHUNITS.filter_price_init=function(){ $("#hunits-filter-price-min").attr('min',nHUNITS.price_min); $("#hunits-filter-price-min").attr('max',nHUNITS.price_max); $("#hunits-filter-price-min").val(nHUNITS.price_min); $("#hunits-filter-price-max").attr('min',nHUNITS.price_min); $("#hunits-filter-price-max").attr('max',nHUNITS.price_max); $("#hunits-filter-price-max").val(nHUNITS.price_min);var v_units_filter_price_min=parseInt($("#hunits-filter-price-min").attr('min').trim(),10);var v_units_filter_price_max=parseInt($("#hunits-filter-price-max").attr('max').trim(),10); $("#hunits-filter-price-slider").slider({animate:true,values:[v_units_filter_price_min,v_units_filter_price_max],range:true,min:v_units_filter_price_min,max:v_units_filter_price_max,step:1,slide:function(event,ui){ $("#hunits-filter-price-min").val(ui.values[0]); $("#hunits-filter-price-max").val(ui.values[1])},change:function(event,ui){ $("#hunits-filter-price-min").val(ui.values[0]); $("#hunits-filter-price-max").val(ui.values[1])}}); $('#hunits-filter-price-min').change(function(e){ $('#hunits-filter-price-slider').slider("values",0, $(this).val())}); $('#hunits-filter-price-max').change(function(e){ $('#hunits-filter-price-slider').slider("values",1, $(this).val())}); $('#hunits-filter-price-min').change(); $('#hunits-filter-price-max').change()};nHUNITS.filter_service_area_init=function(){ $("#hunits-filter-service_area-min").attr('min',nHUNITS.service_area_min); $("#hunits-filter-service_area-max").attr('max',nHUNITS.service_area_max);var v_units_filter_service_area_min=parseInt($("#hunits-filter-service_area-min").attr('min').trim(),10);var v_units_filter_service_area_max=parseInt($("#hunits-filter-service_area-max").attr('max').trim(),10); $("#hunits-filter-service_area-slider").slider({animate:true,values:[v_units_filter_service_area_min,v_units_filter_service_area_max],range:true,min:v_units_filter_service_area_min,max:v_units_filter_service_area_max,step:1,slide:function(p_event,p_ui){ $("#hunits-filter-service_area-min").val(p_ui.values[0]); $("#hunits-filter-service_area-max").val(p_ui.values[1])},change:function(p_event,p_ui){ $("#hunits-filter-service_area-min").val(p_ui.values[0]); $("#hunits-filter-service_area-max").val(p_ui.values[1])}}); $('#hunits-filter-service_area-min').change(function(){ $('#hunits-filter-service_area-slider').slider("values",0, $(this).val())}); $('#hunits-filter-service_area-max').change(function(){ $('#hunits-filter-service_area-slider').slider("values",1, $(this).val())}); $('#hunits-filter-service_area-min').change(); $('#hunits-filter-service_area-max').change()};nHUNITS.filter_noise_level_init=function(){ $("#hunits-filter-noise_level-min1").attr('min',nHUNITS.noise_level_min1); $("#hunits-filter-noise_level-min2").attr('max',nHUNITS.noise_level_min2); $("#hunits-filter-noise_level-max1").attr('min',nHUNITS.noise_level_max1); $("#hunits-filter-noise_level-max2").attr('max',nHUNITS.noise_level_max2);var v_units_filter_noise_level_min1=parseInt($("#hunits-filter-noise_level-min1").attr('min').trim(),10);var v_units_filter_noise_level_min2=parseInt($("#hunits-filter-noise_level-min2").attr('max').trim(),10); $("#hunits-filter-noise_level-min-slider").slider({animate:true,values:[v_units_filter_noise_level_min1,v_units_filter_noise_level_min2],range:true,min:v_units_filter_noise_level_min1,max:v_units_filter_noise_level_min2,step:1,slide:function(event,ui){ $("#hunits-filter-noise_level-min1").val(ui.values[0]); $("#hunits-filter-noise_level-min2").val(ui.values[1])},change:function(event,ui){ $("#hunits-filter-noise_level-min1").val(ui.values[0]); $("#hunits-filter-noise_level-min2").val(ui.values[1])}}); $('#hunits-filter-noise_level-min1').change(function(e){ $('#hunits-filter-noise_level-slider').slider("values",0, $(this).val())}); $('#hunits-filter-noise_level-min2').change(function(e){ $('#hunits-filter-noise_level-slider').slider("values",1, $(this).val())});var v_units_filter_noise_level_max1=parseInt($("#hunits-filter-noise_level-max1").attr('min').trim(),10);var v_units_filter_noise_level_max2=parseInt($("#hunits-filter-noise_level-max2").attr('max').trim(),10); $("#hunits-filter-noise_level-max-slider").slider({animate:true,values:[v_units_filter_noise_level_max1,v_units_filter_noise_level_max2],range:true,min:v_units_filter_noise_level_max1,max:v_units_filter_noise_level_max2,step:1,slide:function(event,ui){ $("#hunits-filter-noise_level-max1").val(ui.values[0]); $("#hunits-filter-noise_level-max2").val(ui.values[1])},change:function(event,ui){ $("#hunits-filter-noise_level-max1").val(ui.values[0]); $("#hunits-filter-noise_level-max2").val(ui.values[1])}}); $('#hunits-filter-noise_level-max1').change(function(e){ $('#hunits-filter-noise_level-slider').slider("values",0, $(this).val())}); $('#hunits-filter-noise_level-max2').change(function(e){ $('#hunits-filter-noise_level-slider').slider("values",1, $(this).val())}); $('#hunits-filter-noise_level-min1').change(); $('#hunits-filter-noise_level-min2').change(); $('#hunits-filter-noise_level-max1').change(); $('#hunits-filter-noise_level-max2').change()};nHUNITS.filter_power_heating_init=function(){ $("#hunits-filter-power_heating-min").attr('min',nHUNITS.power_heating_min); $("#hunits-filter-power_heating-min").attr('max',nHUNITS.power_heating_max); $("#hunits-filter-power_heating-min").val(nHUNITS.power_heating_min); $("#hunits-filter-power_heating-max").attr('min',nHUNITS.power_heating_min); $("#hunits-filter-power_heating-max").attr('max',nHUNITS.power_heating_max); $("#hunits-filter-power_heating-max").val(nHUNITS.power_heating_max);var v_units_filter_power_heating_min=$("#hunits-filter-power_heating-min").attr('min')*1;var v_units_filter_power_heating_max=$("#hunits-filter-power_heating-max").attr('max')*1; $("#hunits-filter-power_heating-slider").slider({animate:true,values:[v_units_filter_power_heating_min,v_units_filter_power_heating_max],range:true,min:v_units_filter_power_heating_min,max:v_units_filter_power_heating_max,step:0.1,slide:function(event,ui){ $("#hunits-filter-power_heating-min").val(ui.values[0]); $("#hunits-filter-power_heating-max").val(ui.values[1])},change:function(event,ui){ $("#hunits-filter-power_heating-min").val(ui.values[0]); $("#hunits-filter-power_heating-max").val(ui.values[1])}}); $('#hunits-filter-power_heating-min').change(function(e){ $('#hunits-filter-power_heating-slider').slider("values",0, $(this).val())}); $('#hunits-filter-power_heating-max').change(function(e){ $('#hunits-filter-power_heating-slider').slider("values",1, $(this).val())}); $('#hunits-filter-power_heating-min').change(); $('#hunits-filter-power_heating-max').change()};nHUNITS.filter_clear=function(){nHUNITS.units_filter_manufacturer_reset(); $("#hunits-filter-price-slider").slider('values',[$("#hunits-filter-price-min").attr('min'), $("#hunits-filter-price-max").attr('max')]); $("#hunits-filter-service_area-slider").slider('values',[$("#hunits-filter-service_area-min").attr('min'), $("#hunits-filter-service_area-max").attr('max')]); $("#hunits-filter-noise_level-min-slider").slider('values',[$("#hunits-filter-noise_level-min1").attr('min'), $("#hunits-filter-noise_level-min2").attr('max')]); $("#hunits-filter-noise_level-max-slider").slider('values',[$("#hunits-filter-noise_level-max1").attr('min'), $("#hunits-filter-noise_level-max2").attr('max')]); $("#hunits-filter-power_heating-slider").slider('values',[$("#hunits-filter-power_heating-min").attr('min'), $("#hunits-filter-power_heating-max").attr('max')])};nHUNITS.refresh_manufacturers=function(){var v_manufacturers=[];for(var v_k in nHUNITS.list){v_manufacturers.push(v_k)}v_manufacturers=v_manufacturers.sort();var v_units_filter_manufacturer=$("#hunits-filter-manufacturer").empty();for(var v_i=0;v_i<v_manufacturers.length;v_i++){var v_item1=nCOMMON.check_new({label:v_manufacturers[v_i],val:v_manufacturers[v_i],checked:true});v_units_filter_manufacturer.append(v_item1)}};nHUNITS.refresh_table=function(){nHUNITS.load(function(){nHUNITS.list2order();nHUNITS.refresh_manufacturers();nHUNITS.show_units_table()})};nHUNITS.refresh_tile=function(){nHUNITS.load(function(){nHUNITS.list2order();nHUNITS.refresh_manufacturers();nHUNITS.show_units_tile()})};nHUNITS.refresh_units=function(p_callback){nHUNITS.load(function(){nHUNITS._loaded=true;nHUNITS.list2order();nHUNITS.refresh_manufacturers();nHUNITS.filter_price_init();nHUNITS.filter_service_area_init();nHUNITS.filter_noise_level_init();nHUNITS.filter_power_heating_init();nHUNITS.filter_clear();nUNITS.manufacture_filter_set('#hunits-filter-manufacturer .check',nUNITS.get_manufacturers_hash());nHUNITS.show_units();if(typeof p_callback==='function'){p_callback()}})};nHUNITS.init=function(){nHUNITS.utypes_show_filter();nHUNITS.options_show_filter(); $('#hunits-filter').on('click','.check-info',function(){var v_data=$(this).data();var v_pos=$(this).position();var v_top=v_pos.top;var v_left=v_pos.left; $('#check-tip').empty().text(v_data.item+' — '+nTERMS.get_item('hunits',v_data.group,v_data.item)); $('#check-tip').css({top:v_top,left:v_left}).show()}); $('#check-tip').click(function(){ $('#check-tip').hide()}); $('#hunits-filter-manufacturer-pop').click(function(){ $('#chunits-filter-manufacturer-all').removeClass('filter-box-bottom-press'); $(this).addClass('filter-box-bottom-press')}); $('#hunits-filter-manufacturer-all').click(function(){ $('#chunits-filter-manufacturer-pop').removeClass('filter-box-bottom-press'); $(this).addClass('filter-box-bottom-press')}); $("#hunits-filter-manufacturer").on('click','.check',function(p_event){nCOMMON.check_toggle(this);nHUNITS.show_units()}); $("#hunits-filter-utype").on('click','.check',function(p_event){nCOMMON.check_toggle(this);nHUNITS.show_units()}); $("#hunits-filter-work_mode").on('click','.check',function(p_event){nCOMMON.check_toggle(this);nHUNITS.show_units()}); $("#hunits-filter-opts").on('click','.check',function(p_event){nCOMMON.check_toggle(this);nHUNITS.show_units()}); $('#hunits-filter-clear').click(nHUNITS.filter_clear); $('#hunits-filter-use').click(function(){nHUNITS.show_units()}); $("#hunits-list").on('click','.unit-item-buy',function(p_event){p_event.stopPropagation();var v_data=$(this).parent().parent().data();nBASKET.add(v_data)}); $("#hunits-list").on('click','.units-item',function(){}); $("#hunits-list").on('click','td',function(p_event){}); $('#hunits-list').on('click','.unit-item-select',nHUNITS._show_info)};nHUNITS.load_unit_info=function(p_unit,p_callback){ $.ajax({type:"POST",url:nCFG.ajax.get_path('get-unit-info.pl'),data:{src:'hunits',manufacturer:p_unit[0],utype:p_unit[1],model:p_unit[2]},dataType:"json",error:nAJAX.ajax_error,success:function(p_res){if(parseInt(p_res.rc,10)!==0){nCOMMON.req_error(p_res);return}if(typeof p_callback==='function'){p_callback(p_res.data)}}})};nHUNITS._show_info=function(){var v_data;if(nHUNITS.units_show_format==='tile'){v_data=$(this).parent().parent().data()}else if(nHUNITS.units_show_format==='table'){v_data=$(this).parent().data()}else{alert("Ошибочный формат отображения списка");return}nHUNITS.show_info(v_data);nCOMMON.show('unit-info',false)};nHUNITS.show_info=function(p_data){nCOMMON.set_hash(encodeURI('#p/unit-info/T1?u='+p_data.manufacturer+'::'+p_data.utype+'::::'+p_data.unit.model));nUNITS.info.image_show(p_data.unit.image); $("#unit-info-title").text(p_data.manufacturer+' / '+p_data.utype+' / '+p_data.unit.model); $("#unit-info-desc").text(p_data.unit.desc);var v_spec=$("#unit-info-spec").empty();v_spec.append('Тепловая мощность, кВт: '+nCOMMON.put_value(p_data.unit.power.heat,1000)+'<br>');v_spec.append('Расход воздуха, м³/час: '+nCOMMON.put_value(p_data.unit.air)+'<br>');v_spec.append('Размер блока, мм: '+nHUNITS.show_sizes(p_data.unit.sizes.int)+'<br>');v_spec.append('Вес, кг: '+nCOMMON.fixed_ru(p_data.unit.weight.int)+'<br>');v_spec.append('Уровень шума (дБ): <i>нет данных</i><br>'); $('#unit-info-reply').empty(); $('#unit-info-talks').empty();if(p_data.unit.href.int){ $("#unit-info-docs").html('Техническая документация: <a href="'+p_data.unit.href.int+'">'+p_data.unit.href.int+'</a><br>')}else{ $("#unit-info-docs").html('Техническая документация: <i>нет данных</i><br>')}if(p_data.unit.href.ext){ $("#unit-info-refs").html('Адрес сайта производителя: <a href="'+p_data.unit.href.ext+'">'+p_data.unit.href.ext+'<br>')}else{ $("#unit-info-refs").html('Адрес сайта производителя: <i>нет данных</i><br>')}nUNITS.info_spec_show()};