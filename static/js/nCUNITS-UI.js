"use strict";nCUNITS.get_manufacturer_filter=function(){var v_manufacturers=[]; $("#cunits-filter-manufacturer .check").each(function(p_index){if(nCOMMON.check_is_on(this)){v_manufacturers.push(nCOMMON.check_value(this))}});return v_manufacturers};nCUNITS.is_utype_ok=function(p_utype){var v_ok=false; $("#cunits-filter-utype div").each(function(p_index){if(nCOMMON.check_is_on(this)){if(nCOMMON.check_value(this)===p_utype){v_ok=true}}});return v_ok};nCUNITS.is_btype_ok=function(p_btype){var v_ok=false; $("#cunits-filter-utype div").each(function(p_index){if(nCOMMON.check_is_on(this)){if(nCOMMON.check_value(this)===p_btype){v_ok=true}}});return v_ok};nCUNITS.get_utypes_filter=function(p_manufacturer){var v_utypes=[];for(var v_utype in nCUNITS.list[p_manufacturer]){if(nCUNITS.is_utype_ok(v_utype)){v_utypes.push(v_utype)}}return v_utypes};nCUNITS.get_btypes_filter=function(p_manufacturer,p_utype){var v_btypes=[];for(var v_btype in nCUNITS.list[p_manufacturer][p_utype]){if(nCUNITS.is_btype_ok(v_btype)){v_btypes.push(v_btype)}}return v_btypes};nCUNITS.get_models_filter=function(p_manufacturer,p_utype,p_btype){var v_models=[];for(var v_model in nCUNITS.list[p_manufacturer][p_utype][p_btype]){v_models.push(v_model)}return v_models};nCUNITS.units_show_reset=function(){var v_show={};v_show.dest=$("#cunits-list").empty();v_show.price_min=parseInt($('#cunits-filter-price-min').val(),10);v_show.price_max=parseInt($('#cunits-filter-price-max').val(),10);v_show.service_area_min=$('#cunits-filter-service_area-min').val()*1;v_show.service_area_max=$('#cunits-filter-service_area-max').val()*1;v_show.noise_level_min1=$('#cunits-filter-noise_level-min1').val()*1;v_show.noise_level_min2=$('#cunits-filter-noise_level-min2').val()*1;v_show.noise_level_max1=$('#cunits-filter-noise_level-max1').val()*1;v_show.noise_level_max2=$('#cunits-filter-noise_level-max2').val()*1;v_show.power_cooling_min=$('#cunits-filter-power_cooling-min').val()*1;v_show.power_cooling_max=$('#cunits-filter-power_cooling-max').val()*1;v_show.power_heating_min=$('#cunits-filter-power_heating-min').val()*1;v_show.power_heating_max=$('#cunits-filter-power_heating-max').val()*1;return v_show};nCUNITS.units_show_excl=function(p_show,p_manufacturer,p_btype,p_utype,p_unit){if(p_unit.state===0){return true}var v_price=nUNITS.get_price(p_unit);if((v_price<p_show.price_min)||(v_price>p_show.price_max)){return true}if((nCUNITS.power_max(p_unit.power.cold)<p_show.power_cooling_min*1000)||(nCUNITS.power_max(p_unit.power.cold)>p_show.power_cooling_max*1000)){return true}if((nCUNITS.power_max(p_unit.power.heat)<p_show.power_heating_min*1000)||(nCUNITS.power_max(p_unit.power.heat)>p_show.power_heating_max*1000)){return true}if(nCUNITS.find.text){var v_res1=nCUNITS.find.test(p_manufacturer+' '+p_btype+' '+p_utype+' '+p_unit.model);var v_res2=nCUNITS.find.test(p_unit.desc);if(!(v_res1||v_res2)){return true}}return false};nCUNITS.show_units_tile=function(){nUNITS.toolbar_show_tile();var v_show=nCUNITS.units_show_reset();nCUNITS.get_units(function(p_manufacturer,p_utype,p_btype,p_model){var v_unit=nCUNITS.list[p_manufacturer][p_utype][p_btype][p_model];if(nCUNITS.units_show_excl(v_show,p_manufacturer,p_utype,p_btype,v_unit)){return}var v_item=nUNITS.units_item(p_manufacturer+' '+p_utype+' '+p_btype+' '+p_model,v_unit.state,nUNITS.get_price(v_unit),v_unit.thumbnail,{unit:v_unit,manufacturer:p_manufacturer,utype:p_utype,btype:p_btype,model:p_model},encodeURI('#p/unit-info/C1?u='+p_manufacturer+'::'+p_utype+'::'+p_btype+'::'+p_model));v_show.dest.append(v_item)})};nCUNITS.show_units_table=function(){nUNITS.toolbar_show_table();var v_show=nCUNITS.units_show_reset();var v_table=$('<table/>',{Class:"listtable",width:'100%'});var v_thead=$('<thead/>');var v_tbody=$('<tbody/>');var v_tr='<tr><th></th><th class="sortable">Производитель</th><th class="sortable">Класс</th><th class="sortable">Тип</th><th class="sortable">Модель</th><th>Вид</th><th class="sortable">Размеры</th><th class="sortable">Холод<br>кВт</th><th class="sortable">Тепло<br>кВт</th><th class="sortable">Цена (руб.)</th></tr>';v_thead.append(v_tr);v_table.append(v_thead);v_table.append(v_tbody);nCUNITS.get_units(function(p_manufacturer,p_utype,p_btype,p_model){var v_unit=nCUNITS.list[p_manufacturer][p_utype][p_btype][p_model];if(nCUNITS.units_show_excl(v_show,p_manufacturer,p_utype,p_btype,v_unit)){return}var v_tr;var v_href=encodeURI('#p/unit-info/C1?u='+p_manufacturer+'::'+p_utype+'::'+p_btype+'::'+p_model);if(v_unit.state===1){v_tr=$('<tr><td align="center"><div class="unit-item-buy typcn typcn-shopping-cart" title="Купить"></div></td><td class="unit-item-select">'+p_manufacturer+'</td><td class="unit-item-select">'+p_utype+'</td><td class="unit-item-select">'+p_btype+'</td><td class="unit-item-select"><a href="'+v_href+'">'+p_model+'</a></td><td align="center">'+nUNITS.img_thumbnail_html(v_unit.thumbnail)+'</td></td><td class="ctxt">'+(v_unit.sizes.ext.width===null?nCUNITS.show_sizes(v_unit.sizes.int):'внутр. '+nCUNITS.show_sizes(v_unit.sizes.int)+'<br>внеш. '+nCUNITS.show_sizes(v_unit.sizes.ext))+'</td><td class="num">'+nCOMMON.put_value(v_unit.power.cold)+'</td><td class="num">'+nCOMMON.put_value(v_unit.power.heat)+'</td><td class="num">'+nUNITS.get_price(v_unit).digits()+'</td></tr>')}else if(v_unit.state===2){v_tr=$('<tr><td align="center"><div class="unit-item-buy typcn typcn-shopping-cart" title="Купить"></div></td><td class="unit-item-select unit-item-on_request">'+p_manufacturer+'</td><td class="unit-item-select unit-item-on_request">'+p_utype+'</td><td class="unit-item-select unit-item-on_request">'+p_btype+'</td><td class="unit-item-select unit-item-on_request">'+p_model+' (под заказ)</td><td align="center">'+nUNITS.img_thumbnail_html(v_unit.thumbnail)+'</td></td><td class="ctxt unit-item-on_request">'+(v_unit.sizes.ext.width===null?nCUNITS.show_sizes(v_unit.sizes.int):'внутр. '+nCUNITS.show_sizes(v_unit.sizes.int)+'<br>внеш. '+nCUNITS.show_sizes(v_unit.sizes.ext))+'</td><td class="num unit-item-on_request">'+nCOMMON.put_value(v_unit.power.cold)+'</td><td class="num unit-item-on_request">'+nCOMMON.put_value(v_unit.power.heat)+'</td><td class="num unit-item-on_request">'+nUNITS.get_price(v_unit).digits()+'</td></tr>')}else{v_tr=$('<tr><td align="center"><div class="unit-item-buy typcn typcn-shopping-cart" title="Купить"></div></td><td class="unit-item-select">'+p_manufacturer+'</td><td class="unit-item-select">'+p_utype+'</td><td class="unit-item-select">'+p_btype+'</td><td class="unit-item-select">'+p_model+'</td><td align="center">'+nUNITS.img_thumbnail_html(v_unit.thumbnail)+'</td></td><td class="ctxt">'+(v_unit.sizes.ext.width===null?nCUNITS.show_sizes(v_unit.sizes.int):'внутр. '+nCUNITS.show_sizes(v_unit.sizes.int)+'<br>внеш. '+nCUNITS.show_sizes(v_unit.sizes.ext))+'</td><td class="num">'+nCOMMON.put_value(v_unit.power.cold)+'</td><td class="num">'+nCOMMON.put_value(v_unit.power.heat)+'</td><td class="num">'+nUNITS.get_price(v_unit).digits()+'</td></tr>')}v_tr.data({unit:v_unit,manufacturer:p_manufacturer,utype:p_utype,btype:p_btype,model:p_model});v_tbody.append(v_tr)});v_show.dest.append(v_table)};nCUNITS.show_units=function(){if(nCUNITS.units_show_format==='tile'){nCUNITS.show_units_tile()}else if(nCUNITS.units_show_format==='table'){nCUNITS.show_units_table()}else{}};nCUNITS.options_show_filter=function(){var v_dest=$("#cunits-filter-opts").empty();var v_options=nTERMS.get_list('cunits','options');for(var v_i=0;v_i<v_options.length;v_i++){var v_opt=nCOMMON.check_new({style:"width:25em;display:inline-block;",val:v_options[v_i],checked:true});v_dest.append(v_opt);v_dest.append('<span class="check-info" data-group="options" data-item="'+v_options[v_i]+'"><span class="icon-help-circled-alt"></span></span>')}};nCUNITS.utypes_show_filter=function(){var v_dest=$("#cunits-filter-utype").empty();var v_items=[['моноблок',['оконный','мобильный']],['мультисплит-система','сплит-система',['канальный','кассетный','колонный','напольно-потолочный','настенный']]];for(var v_i=0;v_i<v_items.length;v_i++){var v_utypes=v_items[v_i];for(var v_ii=0;v_ii<v_utypes.length;v_ii++){if(typeof v_utypes[v_ii]==='string'){var v_opt1=nCOMMON.check_new({style:"width:25em;display:inline-block;",val:v_utypes[v_ii],label:v_utypes[v_ii],checked:true});v_dest.append(v_opt1);v_dest.append('<span class="check-info" data-group="utypes" data-item="'+v_utypes[v_ii]+'"><span class="icon-help-circled-alt"></span></span>')}else{var v_btypes=v_utypes[v_ii];for(var v_iii=0;v_iii<v_btypes.length;v_iii++){var v_opt2=nCOMMON.check_new({style:"width:25em;display:inline-block;",val:v_btypes[v_iii],label:'<span style="margin:2em;font-size:90%">'+v_btypes[v_iii]+'</span>',checked:true});v_dest.append(v_opt2);v_dest.append('<span class="check-info" data-group="btypes" data-item="'+v_btypes[v_iii]+'"><span class="icon-help-circled-alt"></span></span>')}}}}return;var v_dest=$("#cunits-filter-utype").empty();var v_utypes=nTERMS.get_list('cunits','utypes');for(var v_i=0;v_i<v_utypes.length;v_i++){var v_opt=nCOMMON.check_new({style:"width:25em;display:inline-block;",val:v_utypes[v_i],checked:true});v_dest.append(v_opt);v_dest.append('<span class="check-info" data-group="utypes" data-item="'+v_utypes[v_i]+'"><span class="icon-help-circled-alt"></span></span>')}};nCUNITS.btypes_show_filter=function(){return;var v_filter_opts=$("#cunits-filter-btype").empty();var v_btypes=nTERMS.get_list('cunits','btypes');for(var v_i=0;v_i<v_btypes.length;v_i++){var v_opt=nCOMMON.check_new({style:"width:25em;display:inline-block;",val:v_btypes[v_i],checked:true});v_filter_opts.append(v_opt);v_filter_opts.append('<span class="check-info" data-group="btypes" data-item="'+v_btypes[v_i]+'"><span class="icon-help-circled-alt"></span></span>')}};nCUNITS.units_filter_manufacturer_reset=function(){var v_units_manufacturer=$('#cunits-filter-manufacturer .check');for(var v_i=0;v_i<v_units_manufacturer.length;v_i++){nCOMMON.check_on(v_units_manufacturer[v_i])}};nCUNITS.find.set=function(){nCUNITS.find.text=$('#find-text').val().trim();var v_words=nCUNITS.find.text.replace(/([|().+?*\/\[\]])/g,'\\$1').split(/\s+/);var v_req='';nCUNITS.find.req=[];for(var v_i=0;v_i<v_words.length;v_i++){nCUNITS.find.req.push(new RegExp('\\s*'+v_words[v_i],'i'))}nCUNITS.show_units()};nCUNITS.find.test=function(p_str){for(var v_i=0;v_i<nCUNITS.find.req.length;v_i++){if(!nCUNITS.find.req[v_i].test(p_str)){return false}}return true};nCUNITS.find.clear=function(){ $('#find-text').val('');nCUNITS.find.req=[];nCUNITS.req=[];nCUNITS.show_units()};nCUNITS.filter_price_init=function(){ $("#cunits-filter-price-min").attr('min',nCUNITS.price_min); $("#cunits-filter-price-min").attr('max',nCUNITS.price_max); $("#cunits-filter-price-min").val(nCUNITS.price_min); $("#cunits-filter-price-max").attr('min',nCUNITS.price_min); $("#cunits-filter-price-max").attr('max',nCUNITS.price_max); $("#cunits-filter-price-max").val(nCUNITS.price_min);var v_units_filter_price_min=parseInt($("#cunits-filter-price-min").attr('min').trim(),10);var v_units_filter_price_max=parseInt($("#cunits-filter-price-max").attr('max').trim(),10); $("#cunits-filter-price-slider").slider({animate:true,values:[v_units_filter_price_min,v_units_filter_price_max],range:true,min:v_units_filter_price_min,max:v_units_filter_price_max,step:1,slide:function(event,ui){ $("#cunits-filter-price-min").val(ui.values[0]); $("#cunits-filter-price-max").val(ui.values[1])},change:function(event,ui){ $("#cunits-filter-price-min").val(ui.values[0]); $("#cunits-filter-price-max").val(ui.values[1])}}); $('#cunits-filter-price-min').change(function(e){ $('#cunits-filter-price-slider').slider("values",0, $(this).val())}); $('#cunits-filter-price-max').change(function(e){ $('#cunits-filter-price-slider').slider("values",1, $(this).val())}); $('#cunits-filter-price-min').change(); $('#cunits-filter-price-max').change()};nCUNITS.filter_service_area_init=function(){ $("#cunits-filter-service_area-min").attr('min',nCUNITS.service_area_min); $("#cunits-filter-service_area-max").attr('max',nCUNITS.service_area_max);var v_units_filter_service_area_min=parseInt($("#cunits-filter-service_area-min").attr('min').trim(),10);var v_units_filter_service_area_max=parseInt($("#cunits-filter-service_area-max").attr('max').trim(),10); $("#cunits-filter-service_area-slider").slider({animate:true,values:[v_units_filter_service_area_min,v_units_filter_service_area_max],range:true,min:v_units_filter_service_area_min,max:v_units_filter_service_area_max,step:1,slide:function(event,ui){ $("#cunits-filter-service_area-min").val(ui.values[0]); $("#cunits-filter-service_area-max").val(ui.values[1])},change:function(event,ui){ $("#cunits-filter-service_area-min").val(ui.values[0]); $("#cunits-filter-service_area-max").val(ui.values[1])}}); $('#cunits-filter-service_area-min').change(function(e){ $('#cunits-filter-service_area-slider').slider("values",0, $(this).val())}); $('#cunits-filter-service_area-max').change(function(e){ $('#cunits-filter-service_area-slider').slider("values",1, $(this).val())}); $('#cunits-filter-service_area-min').change(); $('#cunits-filter-service_area-max').change()};nCUNITS.filter_noise_level_init=function(){ $("#cunits-filter-noise_level-min1").attr('min',nCUNITS.noise_level_min1); $("#cunits-filter-noise_level-min2").attr('max',nCUNITS.noise_level_min2); $("#cunits-filter-noise_level-max1").attr('min',nCUNITS.noise_level_max1); $("#cunits-filter-noise_level-max2").attr('max',nCUNITS.noise_level_max2);var v_units_filter_noise_level_min1=parseInt($("#cunits-filter-noise_level-min1").attr('min').trim(),10);var v_units_filter_noise_level_min2=parseInt($("#cunits-filter-noise_level-min2").attr('max').trim(),10); $("#cunits-filter-noise_level-min-slider").slider({animate:true,values:[v_units_filter_noise_level_min1,v_units_filter_noise_level_min2],range:true,min:v_units_filter_noise_level_min1,max:v_units_filter_noise_level_min2,step:1,slide:function(event,ui){ $("#cunits-filter-noise_level-min1").val(ui.values[0]); $("#cunits-filter-noise_level-min2").val(ui.values[1])},change:function(event,ui){ $("#cunits-filter-noise_level-min1").val(ui.values[0]); $("#cunits-filter-noise_level-min2").val(ui.values[1])}}); $('#cunits-filter-noise_level-min1').change(function(e){ $('#cunits-filter-noise_level-slider').slider("values",0, $(this).val())}); $('#cunits-filter-noise_level-min2').change(function(e){ $('#cunits-filter-noise_level-slider').slider("values",1, $(this).val())});var v_units_filter_noise_level_max1=parseInt($("#cunits-filter-noise_level-max1").attr('min').trim(),10);var v_units_filter_noise_level_max2=parseInt($("#cunits-filter-noise_level-max2").attr('max').trim(),10); $("#cunits-filter-noise_level-max-slider").slider({animate:true,values:[v_units_filter_noise_level_max1,v_units_filter_noise_level_max2],range:true,min:v_units_filter_noise_level_max1,max:v_units_filter_noise_level_max2,step:1,slide:function(event,ui){ $("#cunits-filter-noise_level-max1").val(ui.values[0]); $("#cunits-filter-noise_level-max2").val(ui.values[1])},change:function(event,ui){ $("#cunits-filter-noise_level-max1").val(ui.values[0]); $("#cunits-filter-noise_level-max2").val(ui.values[1])}}); $('#cunits-filter-noise_level-max1').change(function(e){ $('#cunits-filter-noise_level-slider').slider("values",0, $(this).val())}); $('#cunits-filter-noise_level-max2').change(function(e){ $('#cunits-filter-noise_level-slider').slider("values",1, $(this).val())}); $('#cunits-filter-noise_level-min1').change(); $('#cunits-filter-noise_level-min2').change(); $('#cunits-filter-noise_level-max1').change(); $('#cunits-filter-noise_level-max2').change()};nCUNITS.fpower=function(p_val){return(p_val/1000).toFixed(2)};nCUNITS.fvalue=function(p_value){if(p_value===undefined){return'{undef}'}if(p_value===null){return'{null}'}return p_value.toString()};nCUNITS.fpower3=function(p_power){return nCUNITS.fvalue(p_power.min)+'..'+nCUNITS.fvalue(p_power.max)+'('+nCUNITS.fvalue(p_power.rated)+')'};nCUNITS.filter_power_cooling_init=function(){ $("#cunits-filter-power_cooling-min").attr('min',nCUNITS.fpower(nCUNITS.power_cooling_min)); $("#cunits-filter-power_cooling-min").attr('max',nCUNITS.fpower(nCUNITS.power_cooling_max)); $("#cunits-filter-power_cooling-min").val(nCUNITS.fpower(nCUNITS.power_cooling_min)); $("#cunits-filter-power_cooling-max").attr('min',nCUNITS.fpower(nCUNITS.power_cooling_min)); $("#cunits-filter-power_cooling-max").attr('max',nCUNITS.fpower(nCUNITS.power_cooling_max)); $("#cunits-filter-power_cooling-max").val(nCUNITS.fpower(nCUNITS.power_cooling_max));var v_units_filter_power_cooling_min=$("#cunits-filter-power_cooling-min").attr('min')*1;var v_units_filter_power_cooling_max=$("#cunits-filter-power_cooling-max").attr('max')*1; $("#cunits-filter-power_cooling-slider").slider({animate:true,values:[v_units_filter_power_cooling_min,v_units_filter_power_cooling_max],range:true,min:v_units_filter_power_cooling_min,max:v_units_filter_power_cooling_max,step:0.1,slide:function(event,ui){ $("#cunits-filter-power_cooling-min").val(ui.values[0]); $("#cunits-filter-power_cooling-max").val(ui.values[1])},change:function(event,ui){ $("#cunits-filter-power_cooling-min").val(ui.values[0]); $("#cunits-filter-power_cooling-max").val(ui.values[1])}}); $('#cunits-filter-power_cooling-min').change(function(e){ $('#cunits-filter-power_cooling-slider').slider("values",0, $(this).val())}); $('#cunits-filter-power_cooling-max').change(function(e){ $('#cunits-filter-power_cooling-slider').slider("values",1, $(this).val())}); $('#cunits-filter-power_cooling-min').change(); $('#cunits-filter-power_cooling-max').change()};nCUNITS.filter_power_heating_init=function(){ $("#cunits-filter-power_heating-min").attr('min',nCUNITS.fpower(nCUNITS.power_heating_min)); $("#cunits-filter-power_heating-min").attr('max',nCUNITS.fpower(nCUNITS.power_heating_max)); $("#cunits-filter-power_heating-min").val(nCUNITS.fpower(nCUNITS.power_heating_min)); $("#cunits-filter-power_heating-max").attr('min',nCUNITS.fpower(nCUNITS.power_heating_min)); $("#cunits-filter-power_heating-max").attr('max',nCUNITS.fpower(nCUNITS.power_heating_max)); $("#cunits-filter-power_heating-max").val(nCUNITS.fpower(nCUNITS.power_heating_max));var v_units_filter_power_heating_min=$("#cunits-filter-power_heating-min").attr('min')*1;var v_units_filter_power_heating_max=$("#cunits-filter-power_heating-max").attr('max')*1; $("#cunits-filter-power_heating-slider").slider({animate:true,values:[v_units_filter_power_heating_min,v_units_filter_power_heating_max],range:true,min:v_units_filter_power_heating_min,max:v_units_filter_power_heating_max,step:0.1,slide:function(event,ui){ $("#cunits-filter-power_heating-min").val(ui.values[0]); $("#cunits-filter-power_heating-max").val(ui.values[1])},change:function(event,ui){ $("#cunits-filter-power_heating-min").val(ui.values[0]); $("#cunits-filter-power_heating-max").val(ui.values[1])}}); $('#cunits-filter-power_heating-min').change(function(e){ $('#cunits-filter-power_heating-slider').slider("values",0, $(this).val())}); $('#cunits-filter-power_heating-max').change(function(e){ $('#cunits-filter-power_heating-slider').slider("values",1, $(this).val())}); $('#cunits-filter-power_heating-min').change(); $('#cunits-filter-power_heating-max').change()};nCUNITS.filter_clear=function(){nCUNITS.units_filter_manufacturer_reset(); $("#cunits-filter-price-slider").slider('values',[$("#cunits-filter-price-min").attr('min'), $("#cunits-filter-price-max").attr('max')]); $("#cunits-filter-service_area-slider").slider('values',[$("#cunits-filter-service_area-min").attr('min'), $("#cunits-filter-service_area-max").attr('max')]); $("#cunits-filter-noise_level-min-slider").slider('values',[$("#cunits-filter-noise_level-min1").attr('min'), $("#cunits-filter-noise_level-min2").attr('max')]); $("#cunits-filter-noise_level-max-slider").slider('values',[$("#cunits-filter-noise_level-max1").attr('min'), $("#cunits-filter-noise_level-max2").attr('max')]); $("#cunits-filter-power_cooling-slider").slider('values',[$("#cunits-filter-power_cooling-min").attr('min'), $("#cunits-filter-power_cooling-max").attr('max')]); $("#cunits-filter-power_heating-slider").slider('values',[$("#cunits-filter-power_heating-min").attr('min'), $("#cunits-filter-power_heating-max").attr('max')])};nCUNITS.refresh_manufacturers=function(){var v_manufacturers=nCUNITS.get_manufacturers();var v_units_filter_manufacturer=$("#cunits-filter-manufacturer").empty();var v_wizard_manufacturer=$("#wizard-manufacturer").empty();var v_library_manufacturer=$('#library-manufacturer').empty().append($('<option/>',{text:'',value:''}));for(var v_i=0;v_i<v_manufacturers.length;v_i++){var v_units=nCUNITS.count_units_in(v_manufacturers[v_i]);var v_item1=nCOMMON.check_new({label:v_manufacturers[v_i]+'<span class="filter-units-count">'+v_units+'</span>',val:v_manufacturers[v_i],checked:true});v_units_filter_manufacturer.append(v_item1);var v_item2=nCOMMON.check_new({label:v_manufacturers[v_i]+'<span class="filter-units-count">'+v_units+'</span>',val:v_manufacturers[v_i],checked:true});v_wizard_manufacturer.append(v_item2);var v_item3=$('<option/>',{text:v_manufacturers[v_i],value:v_manufacturers[v_i]});v_library_manufacturer.append(v_item3)} $("#cunits-filter-utype .check").each(function(){var v_value=nCOMMON.check_value(this);if(nCUNITS._counts[v_value]){nCOMMON.check_label(this,v_value+'<span class="filter-units-count">'+nCUNITS._counts[v_value]._all_+'</span>')}else{if(v_value==='мобильный'||v_value==='оконный'){nCOMMON.check_label(this,'<span style="margin:2em;font-size:90%">'+v_value+'<span class="filter-units-count">'+nCUNITS._counts['моноблок'][v_value]+'</span></span>')}else{var v_count=nCUNITS._counts['мультисплит-система'][v_value];v_count+=nCUNITS._counts['сплит-система'][v_value];nCOMMON.check_label(this,'<span style="margin:2em;font-size:90%">'+v_value+'<span class="filter-units-count">'+v_count+'</span></span>')}}})};nCUNITS.refresh_units=function(p_callback){nCUNITS.load(function(){nCUNITS._loaded=true;nCUNITS.list2order();nCUNITS.refresh_manufacturers();nMLINKS.init('#main-manufacturer');nRECIPES.init('#main-recipes');nINFO.init('#main-info');nCUNITS.filter_price_init();nCUNITS.filter_service_area_init();nCUNITS.filter_noise_level_init();nCUNITS.filter_power_cooling_init();nCUNITS.filter_power_heating_init();nCUNITS.filter_clear();nWIZARD.init();nUNITS.manufacture_filter_set('#cunits-filter-manufacturer .check',nUNITS.get_manufacturers_hash());nCUNITS.show_units();if(typeof p_callback==='function'){p_callback()}})};nCUNITS.init=function(){nCUNITS.utypes_show_filter();nCUNITS.btypes_show_filter();nCUNITS.options_show_filter(); $('#cunits-filter').on('click','.check-info',function(){var v_data=$(this).data();var v_pos=$(this).position();var v_top=v_pos.top;var v_left=v_pos.left; $('#check-tip').empty().text(v_data.item+' — '+nTERMS.get_item('cunits',v_data.group,v_data.item)); $('#check-tip').css({top:v_top,left:v_left}).show()}); $('#check-tip').click(function(){ $('#check-tip').hide()}); $('#cunits-filter-manufacturer-pop').click(function(){ $('#cunits-filter-manufacturer-all').removeClass('filter-box-bottom-press'); $(this).addClass('filter-box-bottom-press')}); $('#cunits-filter-manufacturer-all').click(function(){ $('#cunits-filter-manufacturer-pop').removeClass('filter-box-bottom-press'); $(this).addClass('filter-box-bottom-press')}); $("#cunits-filter-manufacturer").on('click','.check',function(p_event){nCOMMON.check_toggle(this);nCUNITS.show_units()}); $("#cunits-filter-utype").on('click','.check',function(p_event){var v_val=nCOMMON.check_value(this);nCOMMON.check_toggle(this);nCUNITS.show_units()}); $("#cunits-filter-btype").on('click','.check',function(p_event){nCOMMON.check_toggle(this);nCUNITS.show_units()}); $("#cunits-filter-work_mode").on('click','.check',function(p_event){nCOMMON.check_toggle(this);nCUNITS.show_units()}); $("#cunits-filter-indoor_units_number").on('click','.radio',function(p_event){var v_item=$(this);var v_number=parseInt(v_item.text(),10); $("#cunits-filter-indoor_units_number span.radio").removeClass('radio-ok');v_item.addClass('radio-ok')}); $("#cunits-filter-opts").on('click','.check',function(p_event){nCOMMON.check_toggle(this);nCUNITS.show_units()}); $('#cunits-filter-clear').click(nCUNITS.filter_clear); $('#cunits-filter-use').click(function(){nCUNITS.show_units()}); $('#find-ext-ref').click(function(p_event){if(nCUNITS.find.ext){ $('#find-ext').hide();nCUNITS.find.ext=false}else{var v_pos=$('#navbar').position();v_pos.top+=$('#navbar').outerHeight(true); $('#find-ext').css({top:v_pos.top,right:0}); $('#find-ext').show();nCUNITS.find.ext=true}p_event.preventDefault()}); $("#cunits-list").on('click','.unit-item-buy',function(p_event){p_event.stopPropagation();var v_data=$(this).parent().parent().data();nBASKET.add(v_data)}); $("#cunits-list").on('click','.units-item',function(){}); $("#cunits-list").on('click','td',function(p_event){}); $('#cunits-list').on('click','.unit-item-select',nCUNITS._show_info);nCUNITS.refresh_units()};nCUNITS.load_unit_info=function(p_unit,p_callback){ $.ajax({type:"POST",url:nCFG.ajax.get_path('get-unit-info.pl'),data:{src:'cunits',manufacturer:p_unit[0],utype:p_unit[1],btype:p_unit[2],model:p_unit[3]},dataType:"json",error:nAJAX.ajax_error,success:function(p_res){if(parseInt(p_res.rc,10)!==0){nCOMMON.req_error(p_res);return}if(typeof p_callback==='function'){p_callback(p_res.data)}}})};nCUNITS._show_info=function(){var v_data;if(nCUNITS.units_show_format==='tile'){v_data=$(this).parent().parent().data()}else if(nCUNITS.units_show_format==='table'){v_data=$(this).parent().data()}else{alert("Ошибочный формат отображения списка");return}nCUNITS.show_info(v_data);nCOMMON.show('unit-info',false)};nCUNITS.show_info=function(p_data){nCOMMON.set_hash(encodeURI('#p/unit-info/C1?u='+p_data.manufacturer+'::'+p_data.utype+'::'+p_data.btype+'::'+p_data.unit.model));if((typeof p_data.unit.image==='undefined')||(p_data.unit.image.length===0)){ $('#unit-info-image').attr('src','/images/no-image.png')}else{ $('#unit-info-image').attr('src',p_data.unit.image[0])}var v_unit_info_images=$('#unit-info-images').empty();for(var v_i=0;v_i<p_data.unit.image.length;v_i++){var v_unit_image_item=$('<div/>',{Class:'unit-info-images-item'});var v_img=$('<img/>',{src:p_data.unit.image[v_i]});v_unit_info_images.append(v_unit_image_item.append(v_img))} $("#unit-info-title").text(p_data.manufacturer+'/'+p_data.utype+'/'+p_data.btype+'/'+p_data.unit.model); $("#unit-info-desc").text(p_data.unit.desc);var v_spec=$("#unit-info-spec").empty();v_spec.append('Потребляемая мощность (КВт):<br>');v_spec.append(' &mdash; при охлаждении: '+nCOMMON.put_value(p_data.unit.power.cold)+'<br>');v_spec.append(' &mdash; при обогреве: '+nCOMMON.put_value(p_data.unit.power.heat)+'<br>');v_spec.append('Расход воздуха, м³/час: '+nCUNITS.f_air(p_data.unit.air)+'<br>');if(p_data.utype==='моноблок'){v_spec.append('Размер блока, мм: '+nCUNITS.show_sizes(p_data.unit.sizes.int)+'<br>');v_spec.append('Вес, кг: '+p_data.unit.weight.int+'<br>')}else{v_spec.append('Размер внутр. блока, мм: '+nCUNITS.show_sizes(p_data.unit.sizes.int)+'<br>');v_spec.append('Размер наруж. блока, мм: '+nCUNITS.show_sizes(p_data.unit.sizes.ext)+'<br>');v_spec.append('Вес, кг вн/внеш: '+p_data.unit.weight.int+'/'+p_data.unit.weight.ext+'<br>')}v_spec.append('Уровень шума (дБ): <i>нет данных</i><br>'); $('#unit-info-reply').empty(); $('#unit-info-talks').empty();if(p_data.unit.href.int){ $("#unit-info-docs").html('Техническая документация: <a href="'+p_data.unit.href.int+'">'+p_data.unit.href.int+'</a><br>')}else{ $("#unit-info-docs").html('Техническая документация: <i>нет данных</i><br>')}if(p_data.unit.href.ext){ $("#unit-info-refs").html('Адрес сайта производителя: <a href="'+p_data.unit.href.ext+'">'+p_data.unit.href.ext+'<br>')}else{ $("#unit-info-refs").html('Адрес сайта производителя: <i>нет данных</i><br>')}nUNITS.info_spec_show()};