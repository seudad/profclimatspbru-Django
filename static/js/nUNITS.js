"use strict";var nUNITS={_uclass:'C1',_current:{},_show:{images:true},info:{},_dummy_:null};nUNITS.set_current=function(p_current){nUNITS._current=p_current};nUNITS.get_price=function(p_unit){if((p_unit.price1===undefined)||(p_unit.price1===null)||(p_unit.price1===0)){if((p_unit.price2===undefined)||(p_unit.price2===null)||(p_unit.price2===0)){return 0.0}return nCBR.usd2rub(p_unit.price2*nSITE.list.price.ratio)}if(p_unit.price1<=p_unit.price2){return nCBR.usd2rub(p_unit.price2*nSITE.list.price.ratio)}return nCBR.usd2rub(p_unit.price1)};nUNITS.refresh=function(){nUNITS.set_class_in_hash();var v_res=nCOMMON.parse_ref();var v_incl_manufacturers=null;var v_opts={};if(v_res){v_incl_manufacturers=v_res[1][3];v_opts=v_res[2];v_res[1]=[v_res[1][0],v_res[1][1],v_res[1][2]];v_res[2]={};var v_ref=nCOMMON.build_ref(v_res);nCOMMON.set_hash(v_ref)}if(nUNITS._uclass==='C1'){nHUNITS.hide();nVUNITS.hide();nUNITS.set_current(nCUNITS);nUNITS.set_manufacturers(v_incl_manufacturers);nUNITS.set_options(v_opts);nCUNITS.show();return}if(nUNITS._uclass==='T1'){nCUNITS.hide();nVUNITS.hide();nUNITS.set_current(nHUNITS);nUNITS.set_manufacturers(v_incl_manufacturers);nUNITS.set_options(v_opts);nHUNITS.show();return}if(nUNITS._uclass==='T2'){nCUNITS.hide();nVUNITS.hide();nUNITS.set_current(nHUNITS);nUNITS.set_manufacturers(v_incl_manufacturers);nUNITS.set_options(v_opts);nHUNITS.show();return}if(nUNITS._uclass==='V1'){nCUNITS.hide();nHUNITS.hide();nUNITS.set_current(nVUNITS);nUNITS.set_manufacturers(v_incl_manufacturers);nUNITS.set_options(v_opts);nVUNITS.show();return}nCUNITS.hide();nHUNITS.hide();nVUNITS.hide()};nUNITS.units_show_format=function(p_format){nUNITS._current.units_show_format=p_format};nUNITS.set_class=function(p_class){nPOPUPMENU.set('#units-toolbar-class',p_class);nUNITS._uclass=p_class;nUNITS.set_class_in_hash()};nUNITS.set_class_in_hash=function(){var v_res=nCOMMON.parse_ref(window.location.hash);v_res[1][2]=nUNITS._uclass;nCOMMON.set_hash(nCOMMON.build_ref(v_res))};nUNITS.info_spec_show=function(){ $('#unit-info-menu .unit-info-menu-item').removeClass('unit-info-menu-item-cur'); $('#unit-info-menu-spec').addClass('unit-info-menu-item-cur'); $('#unit-info-spec').show(); $('#unit-info-reply').hide(); $('#unit-info-talks').hide(); $('#unit-info-refs').hide(); $('#unit-info-docs').hide()};nUNITS.info_reply_show=function(){ $('#unit-info-menu .unit-info-menu-item').removeClass('unit-info-menu-item-cur'); $('#unit-info-menu-reply').addClass('unit-info-menu-item-cur'); $('#unit-info-spec').hide(); $('#unit-info-reply').show(); $('#unit-info-talks').hide(); $('#unit-info-refs').hide(); $('#unit-info-docs').hide()};nUNITS.info_talks_show=function(){ $('#unit-info-menu .unit-info-menu-item').removeClass('unit-info-menu-item-cur'); $('#unit-info-menu-talks').addClass('unit-info-menu-item-cur'); $('#unit-info-spec').hide(); $('#unit-info-reply').hide(); $('#unit-info-talks').show(); $('#unit-info-refs').hide(); $('#unit-info-docs').hide()};nUNITS.info_refs_show=function(){ $('#unit-info-menu .unit-info-menu-item').removeClass('unit-info-menu-item-cur'); $('#unit-info-menu-docs').addClass('unit-info-menu-item-cur'); $('#unit-info-spec').hide(); $('#unit-info-reply').hide(); $('#unit-info-talks').hide(); $('#unit-info-docs').show(); $('#unit-info-refs').hide()};nUNITS.info_docs_show=function(){ $('#unit-info-menu .unit-info-menu-item').removeClass('unit-info-menu-item-cur'); $('#unit-info-menu-refs').addClass('unit-info-menu-item-cur'); $('#unit-info-spec').hide(); $('#unit-info-reply').hide(); $('#unit-info-talks').hide(); $('#unit-info-docs').hide(); $('#unit-info-refs').show()};nUNITS.toolbar_show_table=function(){nUNITS.units_show_format('table'); $('#units-toolbar-show-table').css({color:'#000000'}); $('#units-toolbar-show-tile').css({color:'#bbbbbb'})};nUNITS.toolbar_show_tile=function(){nUNITS.units_show_format('tile'); $('#units-toolbar-show-table').css({color:'#bbbbbb'}); $('#units-toolbar-show-tile').css({color:'#000000'})};nUNITS.init=function(){nPOPUPMENU.init('#units-toolbar-class');nPOPUPMENU.init('#units-toolbar-sort');nPOPUPMENU.init('#units-toolbar-psize');nUNITS.set_current(nCUNITS);nPOPUPMENU.change('#units-toolbar-sort',function(){nUNITS._current.sort.attr=$('#units-toolbar-sort').data('value');nUNITS._current.show_units()});nPOPUPMENU.change('#units-toolbar-class',function(){var v_class=$('#units-toolbar-class').data('value');nUNITS.set_class(v_class);nUNITS.refresh()}); $('#units-toolbar-show-table').click(function(p_event){nUNITS.toolbar_show_table();nUNITS._current.show_units_table()}); $('#units-toolbar-show-tile').click(function(p_event){nUNITS.toolbar_show_tile();nUNITS._current.show_units_tile()}); $('#units-toolbar-image').click(function(){if(nUNITS._show.images){ $(this).css({color:'#bbbbbb'});nUNITS._show.images=false}else{ $(this).css({color:'#000000'});nUNITS._show.images=true}nUNITS._current.show_units()}); $('#units-toolbar-psize').change(function(){}); $('#units-toolbar-refresh').click(function(){nUNITS._current.refresh_units()}); $('#unit-info-images').on('click','.unit-info-images-item',function(){var v_src=$(this).find('img').attr('src'); $('#unit-info-image').attr('src',v_src)}); $('#unit-info-menu-spec').click(nUNITS.info_spec_show); $('#unit-info-menu-reply').click(nUNITS.info_reply_show); $('#unit-info-menu-talks').click(nUNITS.info_talks_show); $('#unit-info-menu-docs').click(nUNITS.info_docs_show); $('#unit-info-menu-refs').click(nUNITS.info_refs_show);nCUNITS.init();nHUNITS.init();nVUNITS.init(); $("#units").on('open',function(){var v_res=nCOMMON.parse_ref();if(v_res){if(v_res[1][2]){nUNITS.set_class(v_res[1][2])}}nUNITS.refresh()}); $('#unit-info').on('open',nUNITS.unit_info_open)};nUNITS.set_manufacturers=function(p_list){if(p_list===undefined){nUNITS._current._manufacturers=null;return}var v_list;if(typeof p_list==='string'){v_list=p_list.split(',')}else{v_list=p_list}nUNITS._current._manufacturers={};for(var v_i=0;v_i<v_list.length;v_i++){nUNITS._current._manufacturers[v_list[v_i]]=true}};nUNITS.get_manufacturers_str=function(p_sep){var v_list=[];for(var v_k in nUNITS._current._manufacturers){v_list.push(nUNITS._current._manufacturers[v_k])}return v_list.join(p_sep||',')};nUNITS.get_manufacturers_hash=function(p_sep){return nUNITS._current._manufacturers};nUNITS.manufacture_filter_set=function(p_check_list,p_name){if(!p_name){return}if(typeof p_name==='string'){ $(p_check_list).each(function(){if(nCOMMON.check_value(this)===p_name){nCOMMON.check_on(this)}else{nCOMMON.check_off(this)}});return}if(typeof p_name==='object'){ $(p_check_list).each(function(){if(p_name[nCOMMON.check_value(this)]){nCOMMON.check_on(this)}else{nCOMMON.check_off(this)}});return}};nUNITS.set_options=function(p_opts){nUNITS._current._opts=p_opts};nUNITS.get_options=function(){return nUNITS._current._opts};nUNITS.is_thumbnail=function(p_thumbnail){if(typeof p_thumbnail!=='string'){return false}if(p_thumbnail===''){return false}return true};nUNITS.img_thumbnail_html=function(p_thumbnail){if(nUNITS.is_thumbnail(p_thumbnail)&&nUNITS._show.images){return'<img src="/images/units/'+p_thumbnail+'" alt="" class="units-item-img">'}return''};nUNITS.units_item=function(p_title,p_state,p_price,p_thumbnail,p_data,p_href){var v_thumbnail='';if(nUNITS._show.images&&p_thumbnail){v_thumbnail='<div class="units-item-thumbnail">'+nUNITS.img_thumbnail_html(p_thumbnail)+'</div>'}var v_item;var v_title=(p_href?'<a href="'+p_href+'">'+p_title+'</a>':p_title);if(p_state===2){v_item=$('<div/>',{Class:'units-item',html:'<div class="units-item-desc"><span class="unit-item-select unit-item-on_request">'+v_title+' (под заказ)</span><br><br>цена: <span class="unit-item-on_request">'+p_price.digits()+' руб.</span></div>'+v_thumbnail+'<div class="units-item-ctrl"><div class="unit-item-buy typcn typcn-shopping-cart" title="Купить"></div><div class="clr"></div></div>',data:p_data});return v_item}v_item=$('<div/>',{Class:'units-item',html:'<div class="units-item-desc"><span class="unit-item-select">'+v_title+'</span><br><br>цена: '+p_price.digits()+' руб.</div>'+v_thumbnail+'<div class="units-item-ctrl"><div class="unit-item-buy typcn typcn-shopping-cart" title="Купить"></div><div class="clr"></div></div>',data:p_data});return v_item};nUNITS.decode_state=function(p_state){switch(Number(p_state)){case 0:return{text:'Н',title:'Недоступен',Class:'state_missing'};case 1:return{text:'Д',title:'Доступен',Class:'state_avail'};case 2:return{text:'З',title:'Под заказ',Class:'state_by_req'};case 3:return{text:'А',title:'Архив',Class:'state_archive'};case 4:return{text:'П',title:'из Паука',Class:'state_spider'};default:return{text:'?',title:'Не опознан ('+p_state+')',Class:'state_unknow'}}};nUNITS.info.image_show=function(p_image){if((typeof(p_image)==='undefined')||(p_image.length===0)){ $('#unit-info-image').attr('src','/images/no-image.png')}else{ $('#unit-info-image').attr('src','/images/units/'+p_image[0])}var v_unit_info_images=$('#unit-info-images').empty();for(var v_i=0;v_i<p_image.length;v_i++){var v_unit_image_item=$('<div/>',{Class:'unit-info-images-item'});var v_img=$('<img/>',{src:'/images/units/'+p_image[v_i]});v_unit_info_images.append(v_unit_image_item.append(v_img))}};nUNITS.unit_info_open=function(){var v_res=nCOMMON.parse_ref();if(v_res){var v_ref=nCOMMON.build_ref(v_res);nCOMMON.set_hash(v_ref)}switch(v_res[1][2]){case'C1':nUNITS.set_current(nCUNITS);break;case'T1':nUNITS.set_current(nHUNITS);break;case'T2':nUNITS.set_current(nHUNITS);break;case'V1':nUNITS.set_current(nVUNITS);break;default:}var v_items=v_res[2].u.v.split('::');nUNITS._current.load_unit_info(v_items,function(p_data){nUNITS._current.show_info(p_data)})};